#!/usr/bin/env ruby

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), "..")

require 'readline'
require './build/scanner'
require './build/parser'

vm = Dagon::Core::VM.new
vm.catch_all_errors
filename = '(stdin)'
while line = Readline.readline('idg:> ', true)
  failed = false
  tokens = Dagon::Scanner.tokenize(line, filename) do |error|
    vm.error("SyntaxError", error)
    failed = true
  end
  next if failed
  tree = Dagon::Parser.parse(tokens, line, false) do |error, stack|
    vm.error("SyntaxError", error)
    failed = true
  end
  next if failed
  value = tree.evaluate(vm)
  if value
    puts "=> #{value.to_s}"
  end
end

