#!/usr/bin/env ruby

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), "..")

require './build/scanner'
require './build/parser'
require 'core/vm'

def run_tests
  $dagon_cwd = Dir.getwd
  vm = Dagon::Core::VM.new
  program = %{require("spec/assertions")\nrequire("spec/dspec")\n}
  tokens = Dagon::Scanner.tokenize(program, '(dspec)')
  tree = Dagon::Parser.parse(tokens, '(dspec)', false)
  tree.evaluate(vm)
  Dir.glob('spec/*_spec.dg').each do |file|
    program << File.open(file, 'rb').read
    program << "\n"
    tokens = Dagon::Scanner.tokenize(program, file)
    tree = Dagon::Parser.parse(tokens, file, false)
    tree.evaluate(vm)
  end
end

run_tests
